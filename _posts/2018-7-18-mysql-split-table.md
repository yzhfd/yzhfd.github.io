# MySQL分库分表
##为何要对MySQL数据库进行分库分表
当一张表的数据达到几千万时，你查询一次所花的时间会变多，如果有联合查询的话，我想有可能会死在那儿了。分表的目的就在于此，减小数据库的负担，缩短查询时间。


mysql中有一种机制是表锁定和行锁定，是为了保证数据的完整性。表锁定表示你们都不能对这张表进行操作，必须等我对表操作完才行。行锁定也一样，别的sql必须等我对这条数据操作完了，才能对这条数据进行操作。

##如何做？

- 大数据量并且访问频繁的表，将其分为若干个表。
  分表可以是垂直拆分（把整数型字段单独放在主表中，字符字段放在从表）
  也可以对表进行水平分片 Sharding（根据路由规则，表数据总数固定比如500w以内）
  最终就是多库多表
  
##这样做会出现什么问题？
- 分库分表维度的问题
  假如用户购买了商品,需要将交易记录保存取来，如果按照用户的纬度分表，则每个用户的交易记录都保存在同一表中，所以很快很方便的查找到某用户的 购买情况，但是某商品被购买的情况则很有可能分布在多张表中，查找起来比较麻烦。反之，按照商品维度分表，可以很方便的查找到此商品的购买情况，但要查找 到买人的交易记录比较麻烦。 
- 联合查询的问题 
  几乎不可能
- 避免跨库事务
   避免在一个事务中修改db0中的表的时候同时修改db1中的表，一个是操作起来更复杂，效率也会有一定影响。 
- 尽量把同一组数据放到同一DB服务器上
  例如将卖家a的商品和交易信息都放到db0中，当db1挂了的时候，卖家a相关的东西可以正常使用。也就是说避免数据库中的数据依赖另一数据库中的数据。 
##总结
- 当读压力很大的时候，可以考虑添加Slave机器的分式解决，但是当Slave机器达到一定的数量就得考虑分库了。
- 当写压力很大的时候，就必须得进行分库操作。

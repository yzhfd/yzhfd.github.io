# Mysql存储引擎对比
## 常用的存储引擎分为InnoDB和MyISAM
### InnoDB引擎
Innodb是mysql默认的事务性引擎，被设计用来处理大量短期事务，这里事务大多数情况下不会发生需要回滚的事情。Innodb
是Mysql最广泛的引擎。
Innodb特性如下：
- Innodb数据存储在表空间中，表空间是一系列文件组成的，由Innodb管理的“黑盒子”
- innodb采用mvcc的高并发策略，实现四个隔离级别，默认是repeatable read（可重复读），并通过间隙锁避免幻读。间隙锁是指不仅锁定涉及的行，还会将索引中的间隙进行锁定。
- innodb采用聚簇索引的方式，索引结构和其他存储引擎很大不同，对主键查询有很高的性能。但是由于其要求二级索引都必须要包含主键，所以主键大会导致索引文件大。因此建表应该设计索引尽量小。
- innodb内部有许多优化，包括从磁盘读取数据时的可预测性预读，自动在内存中创建hash索引，以加速读操作，以及能够加速插入操作的插入缓冲区等。
- innodb支持热备份，而大多数mysql的其他引擎都不支持。
- innodb引擎中，索引和表数据是在同一个文件中，这个和mysiam有很大不同。
### myisam引擎
在mysql5.1之前，mysql默认的引擎是myisam，其提供大量特性，包括全文索引、压缩、空间函数等，但是其不支持事务和行级锁，因此数据库奔溃后很难恢复。
- myisam将数据文件和索引文件分开存，分别是后缀.MYD和.MYI，其行支持动态或静态，会根据表定义来决定行的格式。
- myisam会对整个表加锁，读时加共享锁，写时加排他锁，但是在读的时候也可以插入数据，称为并发插入。
- myisam修复可能导致数据丢失，而且非常慢，通过命令repair table要求修复表。
- 如果设置了delay_key_write，则每次修改完数据，不会立即写入磁盘，而是会写到内存的缓冲区，只有清理缓冲区或关闭表才会写入数据。这样做提升了性能，但是如果数据库奔溃也会导致数据丢失。
- 如果创建数据后，不会在修改，则使用myisam压缩表比较合适，可以使用myisampack对表进行压缩。压缩的数据，如果没有解压，是无法修改的。由于每一行的数据是单独压缩的，因此读取数据不需要解压，这样一来，一次性读入一个压缩表，而不用每次通过I/O从磁盘取数据，极大加快了读取速度。
## 两种引擎的对比如下：
### InnoDB引擎适合线上事物型数据库：
- InnoDB引擎表是基于B+树的索引组织表(IOT)；

- 每个表都需要有一个聚集索引(clustered index)；

- 所有的行记录都存储在B+树的叶子节点(leaf pages of the tree)；

- 基于聚集索引的增、删、改、查的效率相对是最高的；

- 如果我们定义了主键(PRIMARY KEY)，那么InnoDB会选择器作为聚集索引；

- 如果没有显式定义主键，则InnoDB会选择第一个不包含有NULL值的唯一索引作为主键索引；

- 如果也没有这样的唯一索引，则InnoDB会选择内置6字节长的ROWID作为隐含的聚集索引(ROWID随着行记录的写入而主键递增，这个ROWID不像ORACLE的ROWID那样可引用，是隐含的)。

### MYISAM引擎适用于ROLAP数据仓库：

- 读取效率：数据仓库的高并发上承载的大部分是读， MYISAM强调的是性能，每次查询具有原子性,其执行数度比InnoDB类型更快。

- 存储空间：MyISAM： MyISAM的索引和数据是分开的，并且索引是有压缩的，内存使用率就对应提高了不少。InnoDB：需要更多的内存和存储，它会在主内存中建立其专用的缓冲池用于高速缓冲数据和索引。

- MyISAM可移植性备份及恢复：MyISAM：数据是以文件的形式存储，所以在跨平台的数据转移中会很方便。在备份和恢复时可单独针对某个表进行操作。InnoDB：免费的方案可以是拷贝数据文件、备份 binlog，或者用 mysqldump，在数据量达到几十G的时候就相对痛苦了。移植过程中MyISAM不受字典数据的影响。

- 从接触的应用逻辑来说，select count(*) 和order by 是最频繁的，大概能占了整个sql总语句的60%以上的操作，而这种操作Innodb其实也是会锁表的，很多人以为Innodb是行级锁，那个只是where对它主键是有效，非主键的都会锁全表的。但MYISAM对于count操作只需要在元数据中读取，不用扫表。

- 如果和MyISAM比insert写操作的话，Innodb还达不到MyISAM的写性能，如果是针对基于索引的update操作，虽然MyISAM可能会逊色Innodb,但是那么高并发的写，从库能否追的上也是一个问题，且不建议数据仓库中频繁update数据。

- 如果是用MyISAM的话，merge引擎可以大大加快数据仓库开发速度，非常适合大项目总量约几亿的rows某一类型(如日志，调查统计)的业务表。

- 全文索引：MyISAM：支持 FULLTEXT类型的全文索引。InnoDB：不支持FULLTEXT类型的全文索引，但是innodb可以使用sphinx插件支持全文索引，并且效果更好。

- 表主键：MyISAM：允许没有任何索引和主键的表存在，索引都是保存行的地址。InnoDB：如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见)，数据是主索引的一部分，附加索引保存的是主索引的值。

- 对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。

- MyISAM不支持外键，需通过其他方式弥补。


